name: changes

on:
  workflow_call:
    outputs:
      backend:
        description: "Backend changes detected"
        value: ${{ jobs.detect.outputs.backend }}
      frontend:
        description: "Frontend changes detected"
        value: ${{ jobs.detect.outputs.frontend }}

jobs:
  detect:
    runs-on: ubuntu-latest
    outputs:
      backend: ${{ steps.detect-logic.outputs.backend }}
      frontend: ${{ steps.detect-logic.outputs.frontend }}
    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0

      - name: Detect changes since last release
        id: detect-logic
        run: |
          LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null || echo "")
          
          if [ -z "$LAST_TAG" ]; then
            echo "backend=true" >> $GITHUB_OUTPUT
            echo "frontend=true" >> $GITHUB_OUTPUT
            exit 0
          fi

          if git diff --name-only "$LAST_TAG"..HEAD | grep -q '^backend/'; then
            echo "backend=true" >> $GITHUB_OUTPUT
          else
            echo "backend=false" >> $GITHUB_OUTPUT
          fi

          if git diff --name-only "$LAST_TAG"..HEAD | grep -q '^frontend/'; then
            echo "frontend=true" >> $GITHUB_OUTPUT
          else
            echo "frontend=false" >> $GITHUB_OUTPUT
          fi